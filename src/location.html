<!Doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>ASEWF</title>
    <link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css"/>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.8&key=e674676357f84a97c310d3e140594d33&plugin=AMap.Geocoder&plugin=AMap.Autocomplete"></script>
    <script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
<body>
<div id="location"></div>
<div id="result"></div>
<button id='send'>Send weather conditions to the mail</button>
<span>Enter the address you want to check:</span><input id='inputAddress'/><button id='find' onclick='geocoder()'>Find</button><button id='pay'>Paid users can view other cities</button>
<div id="addressResult"></div>
<div id='allmap' style='width: 75%; height: 65%;'></div>
<script type="text/javascript">
    var map, geolocation;
    //Load the map and call the browser location service
    map = new AMap.Map('allmap', {
        resizeEnable: true
    });
    map.plugin('AMap.Geolocation', function() {
        geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,
            timeout: 10000,
            buttonOffset: new AMap.Pixel(10, 20),
            zoomToAccuracy: true,
            buttonPosition:'RB'
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition();
        AMap.event.addListener(geolocation, 'complete', onComplete);//Return location information
        AMap.event.addListener(geolocation, 'error', onError);      //Return positioning error message
    });
	
    //Analyze location results
    function onComplete(data) {
        var str=['Successful positioning'];
        str.push('Longitude：' + data.position.getLng());
        str.push('Latitude：' + data.position.getLat());
		//Reverse address coding
		var geocoder = new AMap.Geocoder({
            radius: 1000,
            extensions: "all"
        });
		lnglatXY = [data.position.getLng(), data.position.getLat()]; 	
        geocoder.getAddress(lnglatXY, function(status, result) {
            if (status === 'complete' && result.info === 'OK') {
                geocoder_CallBack(result);
            }
        });
		var marker = new AMap.Marker({
            map: map,
            position: lnglatXY
        });
        map.setFitView();
        document.getElementById('location').innerHTML = str.join('<br>');
    }
	
    //Parsing positioning error information
    function onError(data) {
        document.getElementById('location').innerHTML = 'Positioning failure';
    }
	
    function geocoder_CallBack(data) {
        var address = data.regeocode.formattedAddress; //Return address description
		document.getElementById("result").innerHTML = 'Current location is:' + address;
    }
	
	function geocoder() {
        var geocoder = new AMap.Geocoder({
        });
        //Geocoding, return geocoding results
		var addressStr = document.getElementById("inputAddress").value;
        geocoder.getLocation(addressStr, function(status, result) {
            if (status === 'complete' && result.info === 'OK') {
                address_CallBack(result);
            }
        });
    }
	
    function addMarker(i, d) {
        var marker = new AMap.Marker({
            map: map,
            position: [ d.location.getLng(),  d.location.getLat()]
        });
    }
	
    //Geocoding returns results display
    function address_CallBack(data) {
        var resultStr = "";
        //Array of geocoded results
        var geocode = data.geocodes;
        for (var i = 0; i < geocode.length; i++) {
            //Splicing output html
            resultStr += "coordinate:" + geocode[i].location.getLng() + ", " + geocode[i].location.getLat();
			addMarker(i, geocode[i]);
        }
        map.setFitView();
        document.getElementById("addressResult").innerHTML = resultStr;
    }
	
	
</script>
</body>
</html>